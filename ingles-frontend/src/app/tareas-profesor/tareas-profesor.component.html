<div class="dashboard-container">
  <!-- Header con gradiente -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-info">
        <h1 class="header-title">ğŸ“ Tareas de Estudiantes</h1>
        <p class="header-subtitle">Gestiona y califica las tareas enviadas por tus estudiantes</p>
        <div class="header-stats">
          <div class="stat-item">
            <span class="stat-icon">ğŸ‘¥</span>
            <span class="stat-value">{{ data.length }}</span>
            <span class="stat-label">Estudiantes</span>
          </div>
          <div class="stat-item">
            <span class="stat-icon">ğŸ“‹</span>
            <span class="stat-value">{{ getTotalTareas() }}</span>
            <span class="stat-label">Total Tareas</span>
          </div>
          <div class="stat-item">
            <span class="stat-icon">âœ…</span>
            <span class="stat-value">{{ getTareasCalificadas() }}</span>
            <span class="stat-label">Calificadas</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros modernos -->
  <div class="filters-section">
    <div class="filters-header">
      <h3 class="filters-title">ğŸ” Filtros de BÃºsqueda</h3>
      <p class="filters-subtitle">Refina tu bÃºsqueda por unidad y rango de fechas</p>
    </div>
    
    <div class="filters-grid">
      <div class="filter-group">
        <label class="filter-label">
          <span class="label-text">ğŸ“š Unidad ID</span>
          <input 
            type="number" 
            [(ngModel)]="unidadId" 
            placeholder="Todas las unidades"
            class="filter-input"
          />
        </label>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">
          <span class="label-text">ğŸ“… Fecha Desde</span>
          <input 
            type="date" 
            [(ngModel)]="desde"
            class="filter-input"
          />
        </label>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">
          <span class="label-text">ğŸ“… Fecha Hasta</span>
          <input 
            type="date" 
            [(ngModel)]="hasta"
            class="filter-input"
          />
        </label>
      </div>
      
      <div class="filter-group">
        <button class="search-btn" (click)="buscar()" [disabled]="loading">
          <span class="btn-icon">ğŸ”</span>
          <span class="btn-text">{{ loading ? 'Buscando...' : 'Buscar Tareas' }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Estados de carga y error -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p class="loading-text">Cargando tareas de estudiantes...</p>
  </div>

  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">âš ï¸</div>
    <h3 class="error-title">Error al cargar tareas</h3>
    <p class="error-message">{{ error }}</p>
    <button class="retry-btn" (click)="buscar()">
      <span class="btn-icon">ğŸ”„</span>
      <span class="btn-text">Reintentar</span>
    </button>
  </div>

  <!-- Grid de estudiantes -->
  <div class="students-grid" *ngIf="!loading && !error">
    <div class="student-card" *ngFor="let estudiante of data; trackBy: trackByEstudiante">
      <!-- Header del estudiante -->
      <div class="student-header">
        <div class="student-avatar">
          <span class="avatar-text">{{ getInitials(estudiante.nombres, estudiante.apellidos) }}</span>
        </div>
        <div class="student-info">
          <h4 class="student-name">{{ estudiante.nombres }} {{ estudiante.apellidos }}</h4>
          <p class="student-username">@{{ estudiante.estudiante_username }}</p>
        </div>
        <div class="student-badge">
          <span class="badge-icon">ğŸ“‹</span>
          <span class="badge-text">{{ estudiante.tareas?.length || 0 }} tareas</span>
        </div>
      </div>

      <!-- Lista de tareas -->
      <div class="tasks-container">
        <div *ngIf="getValidTareas(estudiante.tareas).length > 0; else noTasks" class="tasks-list">
          <div class="task-item" *ngFor="let tarea of getValidTareas(estudiante.tareas); trackBy: trackByTarea">
            <div class="task-info">
              <div class="task-header">
                <span class="task-unit">ğŸ“š Unidad {{ tarea.unidad_id }}</span>
                <span class="task-grade" [class]="getGradeClass(tarea._grade)">
                  {{ getGradeDisplay(tarea._grade) }}
                </span>
              </div>
              <h5 class="task-filename">{{ tarea.filename }}</h5>
              <div class="task-details">
                <span class="task-detail">
                  <span class="detail-icon">ğŸ“</span>
                  <span class="detail-text">{{ formatFileSize(tarea.size) }}</span>
                </span>
                <span class="task-detail">
                  <span class="detail-icon">ğŸ“…</span>
                  <span class="detail-text">{{ formatDate(tarea.upload_date) }}</span>
                </span>
              </div>
            </div>
            
            <div class="task-actions">
              <button 
                class="action-btn download-btn" 
                (click)="descargar(estudiante.estudiante_username, tarea.unidad_id, tarea.filename)"
                title="Descargar archivo"
              >
                <span class="btn-icon">â¬‡ï¸</span>
                <span class="btn-text">Descargar</span>
              </button>
              <button 
                class="action-btn grade-btn" 
                (click)="calificar(estudiante.estudiante_username, tarea.unidad_id, tarea.filename)"
                title="Calificar tarea"
              >
                <span class="btn-icon">âœï¸</span>
                <span class="btn-text">Calificar</span>
              </button>
            </div>
          </div>
        </div>

        <ng-template #noTasks>
          <div class="empty-state">
            <div class="empty-icon">ğŸ“­</div>
            <h4 class="empty-title">Sin tareas</h4>
            <p class="empty-message">No hay tareas en el rango seleccionado</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Estado vacÃ­o general -->
    <div *ngIf="data.length === 0" class="global-empty-state">
      <div class="empty-illustration">ğŸ“š</div>
      <h3 class="empty-title">No se encontraron tareas</h3>
      <p class="empty-message">
        No hay tareas de estudiantes en el rango de fechas seleccionado.
        <br>Intenta ajustar los filtros de bÃºsqueda.
      </p>
      <button class="empty-action-btn" (click)="buscar()">
        <span class="btn-icon">ğŸ”</span>
        <span class="btn-text">Buscar Nuevamente</span>
      </button>
    </div>
  </div>
</div>
