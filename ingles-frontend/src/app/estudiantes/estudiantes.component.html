
<div class="estudiantes-container">
  <div class="estudiantes-header">
    <h2>Estudiantes</h2>
    <span class="estudiantes-subtitle">Bienvenido al dashboard de estudiantes. Aquí podrás gestionar y visualizar información de los estudiantes.</span>
  </div>
  <div class="busqueda-wrapper">
    <div class="busqueda-input-group">
      <span class="material-icons busqueda-icon">search</span>
      <input
        type="text"
        [(ngModel)]="busqueda"
        (input)="filtrarEstudiantes()"
        placeholder="Buscar estudiante por nombre, apellido, email o usuario"
        class="busqueda-input"
      />
    </div>
  </div>
  <div class="tabla-wrapper">
    <table class="tabla-estudiantes">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Apellidos</th>
          <th>Email</th>
          <th>Usuario</th>
          <th>Ciudad</th>
          <th>Teléfono</th>
          <th>Unidades</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let est of estudiantesFiltrados">
          <td>{{ est.nombres }}</td>
          <td>{{ est.apellidos }}</td>
          <td>{{ est.email }}</td>
          <td>{{ est.username }}</td>
          <td>{{ est.ciudad }}</td>
          <td>{{ est.telefono }}</td>
          <td class="unidades-cell">
            <button class="btn-unidades" (click)="abrirModalUnidades(est)" title="Gestionar Unidades">
              <span class="material-icons">school</span>
              Unidades
            </button>
          </td>
          <td class="acciones">
            <button mat-icon-button class="accion-btn" title="Ver"><span class="material-icons">visibility</span></button>
            <button mat-icon-button class="accion-btn" title="Editar"><span class="material-icons">edit</span></button>
            <button mat-icon-button class="accion-btn" title="Eliminar"><span class="material-icons">delete</span></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal para gestionar unidades -->
  <div class="modal-overlay" *ngIf="mostrarModalUnidades" (click)="cerrarModalUnidades()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Gestionar Unidades - {{ estudianteSeleccionado?.nombres }} {{ estudianteSeleccionado?.apellidos }}</h3>
        <button class="btn-cerrar" (click)="cerrarModalUnidades()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="unidades-lista" *ngIf="unidadesEstudiante.length > 0">
          <div class="unidad-item" *ngFor="let unidad of unidadesEstudiante">
            <div class="unidad-info">
              <h4>{{ unidad.nombre }}</h4>
              <p>{{ unidad.descripcion }}</p>
              <div class="unidad-metrics">
                <span class="chip nota" [title]="'Nota calculada de la unidad'">
                  Nota: {{ unidad.nota ?? '—' }}
                </span>
                <span class="chip" [class.aprobado]="unidad.aprobado" [class.pendiente]="!unidad.aprobado" [title]="'Estado según umbral de aprobación'">
                  {{ unidad.aprobado ? 'Aprobado' : 'Pendiente' }}
                </span>
              </div>
            </div>
            <div class="unidad-toggle">
              <button 
                class="btn-toggle"
                [class.activo]="unidad.habilitada"
                [class.inactivo]="!unidad.habilitada"
                (click)="toggleUnidadEstudiante(unidad.id)"
                [disabled]="cargandoUnidad === unidad.id">
                {{ unidad.habilitada ? 'Habilitada' : 'Deshabilitada' }}
              </button>
            </div>
          </div>
        </div>
        <div class="loading" *ngIf="cargandoUnidades">
          Cargando unidades...
        </div>
      </div>
    </div>
  </div>
</div>
