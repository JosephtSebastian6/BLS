
<div class="unidades-container" [ngClass]="{ profesor: tipoUsuario === 'profesor' }">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.2em;">
    <h2>Unidades</h2>
    <button *ngIf="tipoUsuario === 'empresa'" class="crear-unidad-btn" (click)="mostrarFormulario = true" style="background:#22c55e;color:#fff;border:none;padding:0.6em 1.2em;border-radius:6px;font-weight:600;cursor:pointer;">
      <span class="material-icons" style="vertical-align:middle;margin-right:0.3em;">add_circle</span>
      Crear unidad
    </button>
  </div>
  <form *ngIf="mostrarFormulario && tipoUsuario === 'empresa'" (ngSubmit)="guardarUnidad()" style="background:#f3f4f6;padding:1.2em;border-radius:8px;margin-bottom:1.2em;box-shadow:0 2px 8px #0001;max-width:400px;">
    <div style="margin-bottom:0.8em;">
      <label for="nombre" style="font-weight:500;">Nombre:</label>
      <input id="nombre" [(ngModel)]="nuevaUnidad.nombre" name="nombre" required style="width:100%;padding:0.5em;margin-top:0.2em;border-radius:4px;border:1px solid #ccc;" />
    </div>
    <div style="margin-bottom:0.8em;">
      <label for="descripcion" style="font-weight:500;">DescripciÃ³n:</label>
      <input id="descripcion" [(ngModel)]="nuevaUnidad.descripcion" name="descripcion" style="width:100%;padding:0.5em;margin-top:0.2em;border-radius:4px;border:1px solid #ccc;" />
    </div>
    <div style="display:flex;gap:1em;">
      <button type="submit" [disabled]="creando" [class.creando]="creando" style="background:#2563eb;color:#fff;border:none;padding:0.6em 1.2em;border-radius:6px;font-weight:600;cursor:pointer;">
        <span *ngIf="creando" class="spinner" style="display:inline-block;width:14px;height:14px;border:2px solid #fff;border-radius:50%;border-top-color:transparent;animation:spin 1s linear infinite;margin-right:0.5em;"></span>
        {{ creando ? 'Creando...' : 'Guardar' }}
      </button>
      <button type="button" (click)="cancelarUnidad()" [disabled]="creando" style="background:#ef4444;color:#fff;border:none;padding:0.6em 1.2em;border-radius:6px;font-weight:600;cursor:pointer;">Cancelar</button>
    </div>
  </form>
  <div class="galeria-unidades">
    <div class="unidad-card" *ngFor="let unidad of unidades; let i = index" style="position:relative;">
      <div (click)="irADetalleUnidad(unidad)" style="cursor:pointer;">
        <div class="unidad-icono">
          <span class="material-icons">folder</span>
        </div>
        <div class="unidad-info">
          <h3>{{ unidad.nombre }}</h3>
          <p>{{ unidad.descripcion }}</p>
          <span class="subcarpetas">{{ (unidad.subcarpetasCount ?? unidad.subcarpetas.length) }} subcarpetas</span>
        </div>
      </div>
      <button *ngIf="tipoUsuario === 'empresa'" (click)="eliminarUnidad(i, $event)" style="position:absolute;top:10px;right:10px;background:#ef4444;color:#fff;border:none;padding:0.3em 0.8em;border-radius:6px;font-weight:600;cursor:pointer;z-index:2;">Eliminar</button>
      <button *ngIf="tipoUsuario === 'estudiante'"
              (click)="entregarUnidad(i, $event)"
              [disabled]="privadas_entregadas.has(unidad.id!)"
              class="btn-entregar-unidad"
              [style.opacity]="privadas_entregadas.has(unidad.id!) ? 0.85 : 1"
              [style.cursor]="privadas_entregadas.has(unidad.id!) ? 'default' : 'pointer'"
              style="position:absolute;top:10px;left:10px;background:#4CAF50;color:#fff;border:none;padding:0.5em 1em;border-radius:6px;font-weight:600;z-index:2;">
        {{ privadas_entregadas.has(unidad.id!) ? 'Unidad entregada' : 'Entregar Unidad' }}
      </button>
    </div>
  </div>
</div>
