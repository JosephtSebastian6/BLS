<div class="unidad-detalle-container" [ngClass]="{ profesor: tipoUsuario === 'profesor' }">
  <div class="header-container">
    <button class="volver-btn" (click)="volverAUnidades()" aria-label="Volver atrás">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="12" fill="#667eea"/>
        <path d="M13.5 8L9.5 12L13.5 16" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <h2 class="titulo-unidad">Unidad {{ unidadId }}</h2>
  </div>
  <h3 class="subtitulo-subcarpetas">Subcarpetas</h3>
  <div class="galeria-subcarpetas">
    <div class="subcarpeta-card" *ngFor="let sub of subcarpetas; let i = index" [style.opacity]="(tipoUsuario==='estudiante' && sub.habilitada===false) ? 0.5 : 1">
      <span class="material-icons" (click)="irADetalleSubcarpeta(i)" style="cursor:pointer;">folder</span>
      <div *ngIf="editandoIdx !== i">
        <h4 (click)="irADetalleSubcarpeta(i)" style="cursor:pointer;text-decoration:underline;">{{ sub.nombre }}</h4>
        <p>{{ sub.descripcion }}</p>
        <div style="display:flex;align-items:center;gap:0.5em;margin:.25em 0;">
          <span *ngIf="sub.habilitada !== false" style="background:#dcfce7;color:#16a34a;padding:.15em .5em;border-radius:999px;font-size:.75rem;font-weight:700;">Visible</span>
          <span *ngIf="sub.habilitada === false" style="background:#fee2e2;color:#dc2626;padding:.15em .5em;border-radius:999px;font-size:.75rem;font-weight:700;">Oculta</span>
        </div>
        <div>
          <button (click)="iniciarEdicion(i)" style="background:#2563eb;color:#fff;border:none;padding:0.3em 0.8em;border-radius:6px;font-weight:500;cursor:pointer;margin-right:0.5em;" *ngIf="tipoUsuario === 'empresa'">Editar</button>
          <button (click)="eliminarSubcarpeta(i)" style="background:#ef4444;color:#fff;border:none;padding:0.3em 0.8em;border-radius:6px;font-weight:500;cursor:pointer;margin-right:0.5em;" *ngIf="tipoUsuario === 'empresa'">Eliminar</button>
          <button (click)="toggleSubcarpeta(i)" *ngIf="tipoUsuario === 'empresa'"
                  [style.background]="(sub.habilitada===false)?'#16a34a':'#6b7280'"
                  style="color:#fff;border:none;padding:0.3em 0.8em;border-radius:6px;font-weight:600;cursor:pointer;">
            {{ sub.habilitada === false ? 'Mostrar' : 'Ocultar' }}
          </button>
        </div>
      </div>
      <form *ngIf="editandoIdx === i" (ngSubmit)="guardarEdicion()" style="display:flex;flex-direction:column;gap:0.5em;align-items:flex-start;max-width:350px;">
        <input [(ngModel)]="editNombre" name="editNombre" required placeholder="Nombre de subcarpeta" style="padding:0.5em;border-radius:4px;border:1px solid #ccc;width:100%;" />
        <textarea [(ngModel)]="editDescripcion" name="editDescripcion" placeholder="Descripción (opcional)" style="padding:0.5em;border-radius:4px;border:1px solid #ccc;width:100%;min-height:50px;"></textarea>
        <div style="display:flex;gap:0.5em;">
          <button type="submit" style="background:#22c55e;color:#fff;border:none;padding:0.3em 0.8em;border-radius:6px;font-weight:500;cursor:pointer;">Guardar</button>
          <button type="button" (click)="cancelarEdicion()" style="background:#aaa;color:#fff;border:none;padding:0.3em 0.8em;border-radius:6px;font-weight:500;cursor:pointer;">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Botón para mostrar el formulario de creación de subcarpeta -->
  <button (click)="mostrarFormulario = !mostrarFormulario" style="background:#2563eb;color:#fff;border:none;padding:0.5em 1em;border-radius:6px;font-weight:600;cursor:pointer;margin-top:1em;" *ngIf="tipoUsuario === 'empresa'">
    {{ mostrarFormulario ? 'Cancelar' : 'Crear subcarpeta' }}
  </button>

  <!-- Formulario para crear subcarpeta -->
  <form *ngIf="mostrarFormulario && tipoUsuario === 'empresa'" (ngSubmit)="agregarSubcarpeta()" style="margin-top:1em;display:flex;flex-direction:column;gap:1em;align-items:flex-start;max-width:400px;">
    <input [(ngModel)]="nuevaSubcarpetaNombre" name="nombreSubcarpeta" required placeholder="Nombre de subcarpeta" style="padding:0.5em;border-radius:4px;border:1px solid #ccc;width:100%;" />
    <textarea [(ngModel)]="nuevaSubcarpetaDescripcion" name="descripcionSubcarpeta" placeholder="Descripción (opcional)" style="padding:0.5em;border-radius:4px;border:1px solid #ccc;width:100%;min-height:60px;"></textarea>
    <button type="submit" style="background:#22c55e;color:#fff;border:none;padding:0.5em 1em;border-radius:6px;font-weight:600;cursor:pointer;align-self:flex-end;">Crear</button>
  </form>
</div>
